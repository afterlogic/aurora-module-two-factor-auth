<!DOCTYPE html>
<html>
	<head>
		<title></title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<link type="text/css" rel="stylesheet" href="./static/styles/themes/{{Theme}}/styles.css" />
		<script type="text/javascript">
			function base64ToArrayBuffer (sBase64)
			{
				var
					sBinary = window.atob(sBase64),
					iLen = sBinary.length,
					oBytes = new Uint8Array(iLen)
				;
				for (var i = 0; i < iLen; i++)
				{
					oBytes[i] = sBinary.charCodeAt(i);
				}
				return oBytes.buffer;
			}
			
			function arrayBufferToBase64 (buffer)
			{
				var
					sBinary = '',
					oBytes = new Uint8Array(buffer),
					iLen = oBytes.byteLength
				;
				for (var i = 0; i < iLen; i++)
				{
					sBinary += String.fromCharCode(oBytes[ i ]);
				}
				return window.btoa(sBinary);
			};


			var
				bSecurityKeysNotSupportedError = !(navigator.credentials && navigator.credentials.get),
				bIsHttps = window.location.protocol === 'https:'
			;
			if (!bIsHttps || bSecurityKeysNotSupportedError)
			{
				window.Attestation = {
					error: {
						https: !bIsHttps,
						support: bSecurityKeysNotSupportedError
					}
				};
			}
			else
			{
				var oGetArgs = {{GetArgs}};
				var sError = '{{Error}}';
				if (oGetArgs)
				{
					oGetArgs.publicKey.challenge = base64ToArrayBuffer(oGetArgs.publicKey.challenge);
					oGetArgs.publicKey.allowCredentials.forEach(element => {
						element.id = base64ToArrayBuffer(element.id);
					});
					navigator.credentials.get(oGetArgs)
						.then((oCreds) => {
							var oCredsResponse = oCreds && oCreds.response;
							window.Attestation = {
								id: oCreds && oCreds.rawId ? arrayBufferToBase64(oCreds.rawId) : null,
								clientDataJSON: oCredsResponse && oCredsResponse.clientDataJSON  ? arrayBufferToBase64(oCredsResponse.clientDataJSON) : null,
								authenticatorData: oCredsResponse && oCredsResponse.authenticatorData ? arrayBufferToBase64(oCredsResponse.authenticatorData) : null,
								signature : oCredsResponse && oCredsResponse.signature ? arrayBufferToBase64(oCredsResponse.signature) : null
							}
						})
						.catch((err) => {
							window.Attestation = {
								error: {
									cancel: true,
									message: err.message
								}
							};
						});
				}
				else
				{
					window.Attestation = {
						error: {
							message: sError
						}
					};
				}
			}
		</script>
		<style>
			html {
				height: auto; 
				min-width: auto; 
				min-height: auto; 
			}
			body {
				background-size: auto;
			}
		</style>
	</head>
	<body>
		<div class="screen LoginLayout">
			<div class="login_panel" style="width: auto;">
				<div class="header">
					<span class="icon"></span>
				</div>
				<div class="welcome welcome-reset-password">
					<div>{{Description}}</div>
					<div style="margin-top: 10px;"><img src="./static/styles/images/wait.gif" /></div>
				</div>
			</div>
		</div>
	</body>
</html>
